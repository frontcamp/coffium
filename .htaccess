#
# Encoding
AddDefaultCharset UTF-8

#
# Disable directory browsing

Options -Indexes -MultiViews

#
# Icon and SVG MIME types

AddType image/x-icon .ico
AddType image/svg+xml .svg

#
# Redirections

RewriteEngine On

#
# HTTP to HTTPS (direct + reverse proxy)
# Warning: must affect HTTP requests ONLY! (excl. ws, wss, etc.)
RewriteCond %{HTTP_UPGRADE} !websocket [NC]
RewriteCond %{HTTPS} !=on
RewriteCond %{HTTP:X-Forwarded-Proto} !https [NC]
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

#
# Remove "www" from host name

RewriteCond %{HTTP_HOST} ^www\.(.+)$ [NC]
RewriteRule ^ https://%1%{REQUEST_URI} [L,R=301]

#
# Core

RewriteRule ^code/[^/]+/(_admin|_docs|_lang|_libs)(/.*)?$ / [L,R=301]

RewriteRule ^favicon\.ico$ - [L]
RewriteRule ^robots\.txt$ - [L]
RewriteRule ^code/.+/_cron(/.*)?$ - [L]
RewriteRule ^code/.+/web(/.*)?$  - [L]
RewriteRule ^(.*)$ index.php [L]

