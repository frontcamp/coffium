
Coding style guide
==================


В этом документе даны рекомендации по оформлению кода.


PHP модуль
----------

Закрывающий PHP тег не ставится, если код занимает весь файл:

```php
<?php
# code
```


Интеграция PHP в HTML
---------------------

Выполняется с помощью коротких PHP тегов, например:

```php
<p>Today is a <?=($t > 20 ? 'warm' : 'cold')?> day!</p>
```

Данный проект предполагает, что короткие PHP теги обязательно включены. Если они не работают, следует обратиться к администратору и попросить включить их.


Оформление кода
---------------

### Отступы

Для отступов использовать пробелы. Один таб равен 4 пробела.
Многострочные объявления функций следует форматировать так, чтобы аргументы были правее начала имени функции а закрывающая скобка наравне с началом имени функции, например:

```php
function file_put_data(
            string $file_path,
            mixed $data,
            string $var_name = 'DATA'
         ): void
{...}
```

Комментарии
-----------

Используются несколько типов комментариев: заголовок модуля, заголовки секций, стратегические комментарии (назначение следующего блока кода) и тактические/инлайн (детали реализации).

### Заголовок модуля

В начале каждого модуля — короткий комментарий с его назначением:

```php
<?php
/* Core request analyser */

```

### Заголовки секций

Крупные логические блоки в файле отделяются заметными заголовками:

```php
/**
 * REQUEST NORMALIZATION
 * ---------------------
 */
```

Такой комментарий отбивается двумя пустыми строками сверху и одной пустой строкой снизу.

Заголовки второго уровня:

```php
## Normalization rules
```

Заголовки второстепенных блоков отбиваются пустыми строками сверху и снизу.

### Стратегические комментарии

Стратегические комментарии описывают назначение и ставятся перед блоком кода:

```php
# cut expensive processing for empty input
if (count($items) === 0) return [];
process_items($items);
```

Такие комментарии не дублируют код, а объясняют назначение, причину, ограничения, побочные эффекты.

### Тактические (инлайн) комментарии

Тактические комментарии поясняют неочевидные детали реализации. Краткие комментарии допускаются в конце строки, более длинные — перед строкой:

```php
$mask = $flags & 0b0100;  # extract "admin" bit
$is_admin = ($mask !== 0);
```

### Объявление функций и классов

Следует:
- использовать строгую типизацию, где это возможно;
- использовать DocBlock комментарии (формат PHPDoc);
- не использовать хаки и оптимизации (пока это не запрошено явно), читабельность и понятность на первом месте.


Разное
------

Рекомендации:
- комментарии пишутся на языке проекта (обычно английский);
- секции верхнего уровня комментируются в верхнем регистре;
- секции второго и третьего уровней комментируются с заглавной буквы;
- стратегические и тактические комментарии пишутся с маленькой буквы;
- не описываем очевидное "что делает код", фокус на "почему так" и "какие есть подводные камни".

**ИСКЛЮЧЕНИЕ:** если в стратегическом комментарии два и более предложений, следует оформлять их как обычный текст, с больших букв и с точками в конце.

Комментарии вида `//` используются только как временные, чтобы обратить на себя внимание, например:

```php
// TODO: do something very important!
```

