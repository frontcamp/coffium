
Coffium::CORE
=============

Назначение и границы ядра
-------------------------

### Состав ядра

```/libs``` - библиотеки ядра
```.htaccess``` - перенаправление запросов на index.php
```config-*.php``` - файлы конфигурации системы, окружения и проекта
```index.php``` - точка входа в обработку запроса

### Задачи ядра (жизненный цикл запроса)

1) перенаправление всех запросов на ```index.php``` ```(.htaccess)```
2) инициализация системы ```(config-*.php)```
3) организация системного реестра ```($SYS, /libs/inc.registry.php)```
4) анализ запроса ```(/libs/inc.request.php)```
5) автозапуск компонентов ```(/coms/__init__.php)```
6) маршрутизация и реализация зависимостей ```(/libs/inc.response.php)```
7) финализация

### Чего ядро НЕ делает

Ядро Coffium минималистично. Предполагается, что вся дополнительная функциональность реализуется исключительно через компоненты. Таким образом:

- ядро не кеширует
- ядро не блокирует
- ядро не работает с БД
- ядро не шаблонизирует
- ядро не имеет хуков (кроме финализаторов)
- ядро не имеет административного интерфейса
- не печет тортики и не вышивает крестиком


Перенаправление запросов
------------------------

С помощью .htaccess все запросы перенаправляются на ```index.php```

Исключения:
- ```favicon.ico```
- ```robots.txt```
- ```/web``` каталоги в дереве компонентов ```/coms```

При необходимости список исключений может быть расширен.


Инициализация системы
---------------------

### config-global.php

Глобальная конфигурация определяет параметры ядра, системы, PHP и спец. доступа.

#### ML_URL_SUPPORT = <True|False>

Поддержка URL-мультиязычности. Если установлен True, маршрутизатор будет пропускать (игнорировать) первую часть пути URL-адреса. Например, при запросе:

```https://<server>/de/home/```

Часть ```de``` игнорируется, а маршрутизатор ищет обработчик страницы в корне компонента: ```/coms/home```

Этот флаг обеспечивает работу механизма URL-мультиязычности. Подразумевается, что первая (игнорируемая) часть используется компонентом мультиязычности (например, ```mlang```) для определения текущего языка и подключения соответствующего словаря с переводами.

Флаг следует отключить, если вы используете другой механизм реализации мультиязычности, например, переключение языка с помощью GET/POST параметра.

#### ML_DIR_SUPPORT = <True|False>

Флаг отвечает за подключение языковых файлов (словарей) компонентов и обработчиков из всех каталогов ```/_lang``` от корня компонента до каталога где находится обработчик.

Ядро отвечает за подключение этих файлов, но не определяет их формат. Формат словарей должен быть согласован с компонентом мультиязычности (например, ```mlang```).

Флаг следует выключить, если вы используете другой механизм реализации мультиязычности, например, суперсловари (глобальные словари в корне проекта или в корне каждого компонента).

ПОДСКАЗКА: компонент с переводами может работать без компонента мультиязычности, с помощью простой заглушки в API:

```php
if (!function_exists('ml')) {
    funtion ml($text) { return $text; }
}
```

При этом сообщения выводятся как есть.





### config-server.php


### config-custom.php


Системный реестр
----------------


Анализ запроса
--------------


Автозапуск компонентов
----------------------


Маршрутизация и реализация зависимостей
---------------------------------------


Финализация
-----------


Отладка и VIP режим
-------------------

